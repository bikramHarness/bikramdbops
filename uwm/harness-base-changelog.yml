databaseChangeLog:
  - changeSet:
      id: create-prdata-schema
      author: satwell
      changes:
        - sql:
            sql: IF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = 'PRDATA') BEGIN EXEC('CREATE SCHEMA PRDATA') END 
      rollback:
        - sql:
            sql: DROP SCHEMA PRDATA
  - changeSet:
      id: HACK
      ignore: true
      author: satwell
      changes:
        - sql:
            sql: drop procedure usp_select_UnderwriterConditionReviewETA
      rollback: []
  - changeSet:
      id: create-brwfin-schema
      author: satwell
      changes:
        - sql:
            sql: IF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = 'BRWFIN') BEGIN EXEC('CREATE SCHEMA BRWFIN') END 
      rollback:
        - sql:
            sql: DROP SCHEMA BRWFIN
  - changeSet:
      id: satwell:create-type
      author: satwell
      changes:
      -  sql:
           sql: |
             create type dbo.LoanIdentifierAndUserId AS TABLE (Identifier varchar(128), UserId VarChar(50), LenderDatabaseId VarChar(128), LoanRecordId VarChar(128));
      rollback:
      -  sql:
          sql:  |
             drop type dbo.LoanIdentifierAndUserId;
  - changeSet:
      id: create-title-commitment-proc
      author: satwell
      ignore: true
      changes:
      -  sql:
           sql: |
             create PROCEDURE [dbo].[USFS_Insert_PostClosingMissingFinalDocs]
             (@LoanList dbo.LoanIdentifierAndUserId READONLY)
             AS
             BEGIN
               PRINT 'Hello From The Database!';
             END;
      rollback:
      -  dropProcedure:
          procedureName:  USFS_Insert_PostClosingMissingFinalDocs
  - changeSet:
      id: satwell:create-empty-procedure
      author: satwell
      changes:
      -  sql:
           sql: |
             create PROCEDURE [dbo].[USFS_Insert_PostClosingMissingFinalDocs]
             (@LoanList dbo.LoanIdentifierAndUserId READONLY)
             AS
             BEGIN
               PRINT 'Hello From The Database!';
             END;
      rollback:
      -  dropProcedure:
          procedureName: USFS_Insert_PostClosingMissingFinalDocs 
  - changeSet:
      id: satwell:create-empty-procedure3
      author: satwell
      changes:
      -  sql:
           sql: |
             create PROCEDURE [dbo].[USFS_WaiveEscrowsCheckEligible]
             AS
             BEGIN
               PRINT 'Hello From The Database!';
             END;
      rollback:
      -  dropProcedure:
          procedureName: USFS_WaiveEscrowsCheckEligible 
  - changeSet:
      id: satwell:create-empty-procedure4
      author: satwell
      changes:
      -  sql:
           sql: |
             create PROCEDURE [dbo].[usp_Get_SetupFeeBucketHInformation]
             AS
             BEGIN
               PRINT 'Hello From The Database!';
             END;
      rollback:
      -  dropProcedure:
          procedureName: usp_Get_SetupFeeBucketHInformation   
  - changeSet:
      id: create-lndata-schema
      author: satwell
      changes:
        - sql:
            sql: IF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = 'LNDATA') BEGIN EXEC('CREATE SCHEMA LNDATA') END 
      rollback:
        - sql:
            sql: DROP SCHEMA LNDATA
  - changeSet:
      id: satwell:create-empty-procedure5
      author: satwell
      changes:
      -  sql:
           sql: |
             create PROCEDURE [LNDATA].[usp_Select_Loan]
             AS
             BEGIN
               PRINT 'Hello From The Database!';
             END;
      rollback:
      -  dropProcedure:
          procedureName: usp_Select_Loan 
          schemaName: LNDATA
  - changeSet:
      id: satwell:create-empty-procedure2
      author: satwell
      changes:
      -  sql:
           sql: |
             create PROCEDURE [PRDATA].[USFS_usp_select_TitleCommitmentData]
             AS
             BEGIN
               PRINT 'Hello From The Database!';
             END;
      rollback:
      -  dropProcedure:
          procedureName:  USFS_usp_select_TitleCommitmentData
          schemaName: PRDATA
  - changeSet:
      id: create-base-tables
      author: satwell
      changes:
        - createTable:
            tableName: usfs_configuration
            columns:
              - column:
                  name: KAFKAFICO
                  type: VARCHAR(50)
              - column:
                  name: category
                  type: VARCHAR(75)
              - column:
                  name: environment
                  type: VARCHAR(20)
              - column:
                  name: GRPIDVAL
                  type: VARCHAR(75)
              - column:
                  name: DATE
                  type: DATETIME
              - column:
                  name: setting
                  type: VARCHAR(max)
              - column:
                  name: NAME
                  type: VARCHAR(max)
              - column:
                  name: value
                  type: VARCHAR(max)
        - createTable:
            tableName: loan_main
            columns:
              - column:
                  name: lenderdatabaseid
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: loanrecordid
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: productid
                  type: int
              - column:
                  name: creditscore
                  type: int
              - column:
                  name: statusid
                  type: int
              - column:
                  name: customergroupid 
                  type: int
              - column:
                  name: propertyrecordid
                  type: int
              - column:
                  name: propertylenderdatabaseid
                  type: int
              - column:
                  name: agencycasenumber
                  type: varchar(20)
              - column:
                  name: feesimple
                  type: varchar(1)
              - column:
                  name: leasehold
                  type: varchar(1)
              - column:
                  name: leasedfee
                  type: varchar(1)
              - column:
                  name: occupancyTypeId
                  type: varchar(1)
              - column:
                  name: leaseholdexpiration
                  type: datetime
              - column:
                  name: dateoffirstpayment
                  type: datetime
              - column:
                  name: purposetypeid
                  type: int
              - column:
                  name: contractconversionflag
                  type: bit
              - column:
                  name: lockexpirationdate
                  type: datetime

        - createTable:
            tableName: custom_productmain
            columns:
              - column:
                  name: productId
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: NonAgency
                  type: bit
              - column:
                  name: Nationwide
                  type: bit
              - column:
                  name: HighLTV
                  type: bit
              - column:
                  name: HELOC
                  type: bit
              - column:
                  name: ProductGroupName
                  type: varchar(50)
              - column:
                  name: va
                  type: bit

        - createTable:
            tableName: loan_processing
            columns:
              - column:
                  name: lenderdatabaseid
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: loanrecordid
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: firsttimehomebuyer
                  type: varchar(1)
              - column:
                  name: refidatelotacquired
                  type: datetime

        - createTable:
            tableName: custom_loanmain
            columns:
              - column:
                  name: lenderdatabaseid
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: loanrecordid
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: SubmittedDate
                  type: datetime
              - column:
                  name: IsBorrowerClosingInTrust
                  type: bit
              - column:
                  name: IsPropertyHeldInTrust
                  type: bit
              - column:
                  name: IsTrustVerifiedByUW
                  type: bit

        - createTable:
            tableName: custom_loanpostclosing
            columns:
              - column:
                  name: lenderdatabaseid
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: loanrecordid
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: WaivedEscrows
                  type: varchar(1)

        - createTable:
            tableName: property_main
            columns:
              - column:
                  name: lenderdatabaseid
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: propertyrecordid
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: state
                  type: varchar(2)
              - column:
                  name: addressline1
                  type: varchar(50)
              - column:
                  name: addressline2
                  type: varchar(50)
              - column:
                  name: city
                  type: varchar(50)
              - column:
                  name: county
                  type: varchar(30)
              - column:
                  name: zipcode
                  type: varchar(15)
              - column:
                  name: investcollateralprogident
                  type: int
              - column:
                  name: SellerDaysOwned
                  type: int
              - column:
                  name: CertOfTitleNumber
                  type: int
              - column:
                  name: AcquisitionPrice
                  type: float
              - column:
                  name: SalesPrice
                  type: float
              - column:
                  name: SellerAcquiredDate
                  type: DATETIME

        - createTable:
            tableName: USFS_CaptureEventType
            columns:
              - column:
                  name: capturetype
                  type: varchar(10)
                  constraints:
                    nullable: false
              - column:
                  name: capturetype_desc
                  type: varchar(100)

  - changeSet:
      id: create-primary-keys
      author: satwell
      changes:
        - addPrimaryKey:
            tableName: loan_main
            columnNames: lenderdatabaseid,loanrecordid
            constraintName: pk_loan_main
            
        - addPrimaryKey:
            tableName: custom_productmain
            columnNames: productId
            constraintName: pk_custom_productmain
            
        - addPrimaryKey:
            tableName: loan_processing
            columnNames: lenderdatabaseid,loanrecordid
            constraintName: pk_loan_processing
            
        - addPrimaryKey:
            tableName: custom_loanmain
            columnNames: lenderdatabaseid,loanrecordid
            constraintName: pk_custom_loanmain
            
        - addPrimaryKey:
            tableName: property_main
            columnNames: lenderdatabaseid,propertyrecordid
            constraintName: pk_property_main
            
        - addPrimaryKey:
            tableName: USFS_CaptureEventType
            columnNames: capturetype
            constraintName: pk_usfs_captureeventtype

  - changeSet:
      id: create-foreign-keys
      author: satwell
      changes:
        - addForeignKeyConstraint:
            baseTableName: loan_main
            baseColumnNames: productid
            constraintName: fk_loan_product
            referencedTableName: custom_productmain
            referencedColumnNames: productId
            
        - addForeignKeyConstraint:
            baseTableName: loan_processing
            baseColumnNames: lenderdatabaseid,loanrecordid
            constraintName: fk_processing_loan
            referencedTableName: loan_main
            referencedColumnNames: lenderdatabaseid,loanrecordid
            
        - addForeignKeyConstraint:
            baseTableName: custom_loanmain
            baseColumnNames: lenderdatabaseid,loanrecordid
            constraintName: fk_customloan_loan
            referencedTableName: loan_main
            referencedColumnNames: lenderdatabaseid,loanrecordid
